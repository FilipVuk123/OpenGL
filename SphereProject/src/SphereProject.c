#define STB_IMAGE_IMPLEMENTATION

#define ORQA_IN
#define ORQA_REF
#define ORQA_OUT
#define ORQA_NOARGS

#define BUFSIZE 1024
#include <glad/glad.h>
#include <GLFW/glfw3.h>
#include <stdio.h>
#include <pthread.h>
#include <time.h>
#include <sys/socket.h>
#include <arpa/inet.h>	// inet_addr
#include <unistd.h>
#include <netinet/in.h>
#include <sys/types.h> 
#include <cglm/cglm.h> 
#include "json.h"
#include "video_reader.h"
#include "stb_image.h" // using this image-loading library
#include "gen_sphere.h"

/*******************************************************************/
/*
const GLfloat vertices[]={
 0.555570, 0.831470, 0.000000, 0.000000, 0.083333, 0.507539, 0.831470, 0.225971, 0.066667, 0.083333, 0.371749, 0.831470, 0.412869, 0.133333, 0.083333, 0.171681, 0.831470, 0.528379, 0.200000, 0.083333, -0.058073, 0.831470, 0.552527, 0.266667, 0.083333, -0.277785, 0.831470, 0.481138, 0.333333, 0.083333, -0.449466, 0.831470, 0.326556, 0.400000, 0.083333, -0.543430, 0.831470, 0.115510, 0.466667, 0.083333, -0.543430, 0.831470, -0.115510, 0.533333, 0.083333, -0.449466, 0.831470, -0.326556, 0.600000, 0.083333, -0.277785, 0.831470, -0.481138, 0.666667, 0.083333, -0.058073, 0.831470, -0.552527, 0.733333, 0.083333, 0.171681, 0.831470, -0.528379, 0.800000, 0.083333, 0.371749, 0.831470, -0.412869, 0.866667, 0.083333, 0.507539, 0.831470, -0.225971, 0.933333, 0.083333, 0.555570, 0.831470, 0.000000, 1.000000, 0.083333, 0.707107, 0.707107, 0.000000, 0.000000, 0.166667, 0.645974, 0.707107, 0.287606, 0.066667, 0.166667, 0.473147, 0.707107, 0.525483, 0.133333, 0.166667, 0.218508, 0.707107, 0.672499, 0.200000, 0.166667, -0.073913, 0.707107, 0.703233, 0.266667, 0.166667, -0.353553, 0.707107, 0.612372, 0.333333, 0.166667, -0.572062, 0.707107, 0.415627, 0.400000, 0.166667, -0.691655, 0.707107, 0.147016, 0.466667, 0.166667, -0.691655, 0.707107, -0.147016, 0.533333, 0.166667, -0.572061, 0.707107, -0.415627, 0.600000, 0.166667, -0.353553, 0.707107, -0.612372, 0.666667, 0.166667, -0.073913, 0.707107, -0.703233, 0.733333, 0.166667, 0.218508, 0.707107, -0.672498, 0.800000, 0.166667, 0.473147, 0.707107, -0.525482, 0.866667, 0.166667, 0.645974, 0.707107, -0.287606, 0.933333, 0.166667, 0.707107, 0.707107, 0.000000, 1.000000, 0.166667, 0.831470, 0.555570, 0.000000, 0.000000, 0.250000, 0.759585, 0.555570, 0.338189, 0.066667, 0.250000, 0.556362, 0.555570, 0.617902, 0.133333, 0.250000, 0.256938, 0.555570, 0.790775, 0.200000, 0.250000, -0.086912, 0.555570, 0.826915, 0.266667, 0.250000, -0.415735, 0.555570, 0.720074, 0.333333, 0.250000, -0.672673, 0.555570, 0.488725, 0.400000, 0.250000, -0.813300, 0.555570, 0.172872, 0.466667, 0.250000, -0.813300, 0.555570, -0.172872, 0.533333, 0.250000, -0.672673, 0.555570, -0.488726, 0.600000, 0.250000, -0.415735, 0.555570, -0.720074, 0.666667, 0.250000, -0.086912, 0.555570, -0.826915, 0.733333, 0.250000, 0.256939, 0.555570, -0.790774, 0.800000, 0.250000, 0.556362, 0.555570, -0.617902, 0.866667, 0.250000, 0.759585, 0.555570, -0.338189, 0.933333, 0.250000, 0.831470, 0.555570, 0.000000, 1.000000, 0.250000, 0.923880, 0.382683, 0.000000, 0.000000, 0.333333, 0.844006, 0.382683, 0.375776, 0.066667, 0.333333, 0.618196, 0.382683, 0.686576, 0.133333, 0.333333, 0.285494, 0.382683, 0.878662, 0.200000, 0.333333, -0.096572, 0.382683, 0.918818, 0.266667, 0.333333, -0.461940, 0.382683, 0.800103, 0.333333, 0.333333, -0.747434, 0.382683, 0.543043, 0.400000, 0.333333, -0.903691, 0.382683, 0.192085, 0.466667, 0.333333, -0.903691, 0.382683, -0.192085, 0.533333, 0.333333, -0.747434, 0.382683, -0.543043, 0.600000, 0.333333, -0.461940, 0.382683, -0.800103, 0.666667, 0.333333, -0.096572, 0.382683, -0.918818, 0.733333, 0.333333, 0.285495, 0.382683, -0.878661, 0.800000, 0.333333, 0.618196, 0.382683, -0.686576, 0.866667, 0.333333, 0.844006, 0.382683, -0.375776, 0.933333, 0.333333, 0.923880, 0.382683, 0.000000, 1.000000, 0.333333, 0.980785, 0.195090, 0.000000, 0.000000, 0.416667, 0.895992, 0.195090, 0.398921, 0.066667, 0.416667, 0.656273, 0.195090, 0.728866, 0.133333, 0.416667, 0.303079, 0.195090, 0.932782, 0.200000, 0.416667, -0.102520, 0.195090, 0.975412, 0.266667, 0.416667, -0.490393, 0.195090, 0.849385, 0.333333, 0.416667, -0.793472, 0.195090, 0.576491, 0.400000, 0.416667, -0.959353, 0.195090, 0.203917, 0.466667, 0.416667, -0.959353, 0.195090, -0.203917, 0.533333, 0.416667, -0.793472, 0.195090, -0.576491, 0.600000, 0.416667, -0.490393, 0.195090, -0.849385, 0.666667, 0.416667, -0.102520, 0.195090, -0.975412, 0.733333, 0.416667, 0.303080, 0.195090, -0.932782, 0.800000, 0.416667, 0.656274, 0.195090, -0.728865, 0.866667, 0.416667, 0.895992, 0.195090, -0.398921, 0.933333, 0.416667, 0.980785, 0.195090, 0.000000, 1.000000, 0.416667, 1.000000, 0.000000, 0.000000, 0.000000, 0.500000, 0.913545, 0.000000, 0.406737, 0.066667, 0.500000, 0.669131, 0.000000, 0.743145, 0.133333, 0.500000, 0.309017, 0.000000, 0.951057, 0.200000, 0.500000, -0.104529, 0.000000, 0.994522, 0.266667, 0.500000, -0.500000, 0.000000, 0.866025, 0.333333, 0.500000, -0.809017, 0.000000, 0.587785, 0.400000, 0.500000, -0.978148, 0.000000, 0.207912, 0.466667, 0.500000, -0.978148, 0.000000, -0.207912, 0.533333, 0.500000, -0.809017, 0.000000, -0.587785, 0.600000, 0.500000, -0.500000, 0.000000, -0.866025, 0.666667, 0.500000, -0.104528, 0.000000, -0.994522, 0.733333, 0.500000, 0.309018, 0.000000, -0.951056, 0.800000, 0.500000, 0.669131, 0.000000, -0.743144, 0.866667, 0.500000, 0.913546, 0.000000, -0.406736, 0.933333, 0.500000, 1.000000, 0.000000, 0.000000, 1.000000, 0.500000, 0.980785, -0.195090, 0.000000, 0.000000, 0.583333, 0.895992, -0.195090, 0.398921, 0.066667, 0.583333, 0.656273, -0.195090, 0.728866, 0.133333, 0.583333, 0.303079, -0.195090, 0.932782, 0.200000, 0.583333, -0.102520, -0.195090, 0.975412, 0.266667, 0.583333, -0.490393, -0.195090, 0.849385, 0.333333, 0.583333, -0.793472, -0.195090, 0.576491, 0.400000, 0.583333, -0.959353, -0.195090, 0.203917, 0.466667, 0.583333, -0.959353, -0.195090, -0.203917, 0.533333, 0.583333, -0.793472, -0.195090, -0.576491, 0.600000, 0.583333, -0.490393, -0.195090, -0.849385, 0.666667, 0.583333, -0.102520, -0.195090, -0.975412, 0.733333, 0.583333, 0.303080, -0.195090, -0.932782, 0.800000, 0.583333, 0.656274, -0.195090, -0.728865, 0.866667, 0.583333, 0.895992, -0.195090, -0.398921, 0.933333, 0.583333, 0.980785, -0.195090, 0.000000, 1.000000, 0.583333, 0.923880, -0.382683, 0.000000, 0.000000, 0.666667, 0.844006, -0.382683, 0.375776, 0.066667, 0.666667, 0.618196, -0.382683, 0.686576, 0.133333, 0.666667, 0.285494, -0.382683, 0.878662, 0.200000, 0.666667, -0.096572, -0.382683, 0.918818, 0.266667, 0.666667, -0.461940, -0.382683, 0.800103, 0.333333, 0.666667, -0.747434, -0.382683, 0.543043, 0.400000, 0.666667, -0.903691, -0.382683, 0.192085, 0.466667, 0.666667, -0.903691, -0.382683, -0.192085, 0.533333, 0.666667, -0.747434, -0.382683, -0.543043, 0.600000, 0.666667, -0.461940, -0.382683, -0.800103, 0.666667, 0.666667, -0.096572, -0.382683, -0.918818, 0.733333, 0.666667, 0.285495, -0.382683, -0.878661, 0.800000, 0.666667, 0.618196, -0.382683, -0.686576, 0.866667, 0.666667, 0.844006, -0.382683, -0.375776, 0.933333, 0.666667, 0.923880, -0.382683, 0.000000, 1.000000, 0.666667, 0.831470, -0.555570, 0.000000, 0.000000, 0.750000, 0.759585, -0.555570, 0.338189, 0.066667, 0.750000, 0.556362, -0.555570, 0.617902, 0.133333, 0.750000, 0.256938, -0.555570, 0.790775, 0.200000, 0.750000, -0.086912, -0.555570, 0.826915, 0.266667, 0.750000, -0.415735, -0.555570, 0.720074, 0.333333, 0.750000, -0.672673, -0.555570, 0.488725, 0.400000, 0.750000, -0.813300, -0.555570, 0.172872, 0.466667, 0.750000, -0.813300, -0.555570, -0.172872, 0.533333, 0.750000, -0.672673, -0.555570, -0.488726, 0.600000, 0.750000, -0.415735, -0.555570, -0.720074, 0.666667, 0.750000, -0.086912, -0.555570, -0.826915, 0.733333, 0.750000, 0.256939, -0.555570, -0.790774, 0.800000, 0.750000, 0.556362, -0.555570, -0.617902, 0.866667, 0.750000, 0.759585, -0.555570, -0.338189, 0.933333, 0.750000, 0.831470, -0.555570, 0.000000, 1.000000, 0.750000, 0.707107, -0.707107, 0.000000, 0.000000, 0.833333, 0.645974, -0.707107, 0.287606, 0.066667, 0.833333, 0.473147, -0.707107, 0.525483, 0.133333, 0.833333, 0.218508, -0.707107, 0.672499, 0.200000, 0.833333, -0.073913, -0.707107, 0.703233, 0.266667, 0.833333, -0.353553, -0.707107, 0.612372, 0.333333, 0.833333, -0.572062, -0.707107, 0.415627, 0.400000, 0.833333, -0.691655, -0.707107, 0.147016, 0.466667, 0.833333, -0.691655, -0.707107, -0.147016, 0.533333, 0.833333, -0.572061, -0.707107, -0.415627, 0.600000, 0.833333, -0.353553, -0.707107, -0.612372, 0.666667, 0.833333, -0.073913, -0.707107, -0.703233, 0.733333, 0.833333, 0.218508, -0.707107, -0.672498, 0.800000, 0.833333, 0.473147, -0.707107, -0.525482, 0.866667, 0.833333, 0.645974, -0.707107, -0.287606, 0.933333, 0.833333, 0.707107, -0.707107, 0.000000, 1.000000, 0.833333, 0.555570, -0.831470, 0.000000, 0.000000, 0.916667, 0.507539, -0.831470, 0.225971, 0.066667, 0.916667, 0.371749, -0.831470, 0.412869, 0.133333, 0.916667, 0.171681, -0.831470, 0.528379, 0.200000, 0.916667, -0.058073, -0.831470, 0.552527, 0.266667, 0.916667, -0.277785, -0.831470, 0.481138, 0.333333, 0.916667, -0.449466, -0.831470, 0.326556, 0.400000, 0.916667, -0.543430, -0.831470, 0.115510, 0.466667, 0.916667, -0.543430, -0.831470, -0.115510, 0.533333, 0.916667, -0.449466, -0.831470, -0.326556, 0.600000, 0.916667, -0.277785, -0.831470, -0.481138, 0.666667, 0.916667, -0.058073, -0.831470, -0.552527, 0.733333, 0.916667, 0.171681, -0.831470, -0.528379, 0.800000, 0.916667, 0.371749, -0.831470, -0.412869, 0.866667, 0.916667, 0.507539, -0.831470, -0.225971, 0.933333, 0.916667, 0.555570, -0.831470, 0.000000, 1.000000, 0.916667, 0.382683, -0.923880, 0.000000, 0.000000, 1.000000, 0.349599, -0.923880, 0.155651, 0.066667, 1.000000, 0.256065, -0.923880, 0.284389, 0.133333, 1.000000, 0.118256, -0.923880, 0.363954, 0.200000, 1.000000, -0.040001, -0.923880, 0.380587, 0.266667, 1.000000, -0.191342, -0.923880, 0.331414, 0.333333, 1.000000, -0.309597, -0.923880, 0.224936, 0.400000, 1.000000, -0.374321, -0.923880, 0.079564, 0.466667, 1.000000, -0.374321, -0.923880, -0.079564, 0.533333, 1.000000, -0.309597, -0.923880, -0.224936, 0.600000, 1.000000, -0.191342, -0.923880, -0.331414, 0.666667, 1.000000, -0.040001, -0.923880, -0.380587, 0.733333, 1.000000, 0.118256, -0.923880, -0.363954, 0.800000, 1.000000, 0.256065, -0.923880, -0.284389, 0.866667, 1.000000, 0.349599, -0.923880, -0.155651, 0.933333, 1.000000, 0.382683, -0.923880, 0.000000, 1.000000, 1.000000, 0.195090, -0.980785, 0.000000, 0.000000, 1.083333,};
const GLuint indices[]={
 0, 17, 16, 0, 1, 17, 1, 18, 17, 1, 2, 18, 2, 19, 18, 2, 3, 19, 3, 20, 19, 3, 4, 20, 4, 21, 20, 4, 5, 21, 5, 22, 21, 5, 6, 22, 6, 23, 22, 6, 7, 23, 7, 24, 23, 7, 8, 24, 8, 25, 24, 8, 9, 25, 9, 26, 25, 9, 10, 26, 10, 27, 26, 10, 11, 27, 11, 28, 27, 11, 12, 28, 12, 29, 28, 12, 13, 29, 13, 30, 29, 13, 14, 30, 14, 31, 30, 14, 15, 31, 16, 33, 32, 16, 17, 33, 17, 34, 33, 17, 18, 34, 18, 35, 34, 18, 19, 35, 19, 36, 35, 19, 20, 36, 20, 37, 36, 20, 21, 37, 21, 38, 37, 21, 22, 38, 22, 39, 38, 22, 23, 39, 23, 40, 39, 23, 24, 40, 24, 41, 40, 24, 25, 41, 25, 42, 41, 25, 26, 42, 26, 43, 42, 26, 27, 43, 27, 44, 43, 27, 28, 44, 28, 45, 44, 28, 29, 45, 29, 46, 45, 29, 30, 46, 30, 47, 46, 30, 31, 47, 32, 49, 48, 32, 33, 49, 33, 50, 49, 33, 34, 50, 34, 51, 50, 34, 35, 51, 35, 52, 51, 35, 36, 52, 36, 53, 52, 36, 37, 53, 37, 54, 53, 37, 38, 54, 38, 55, 54, 38, 39, 55, 39, 56, 55, 39, 40, 56, 40, 57, 56, 40, 41, 57, 41, 58, 57, 41, 42, 58, 42, 59, 58, 42, 43, 59, 43, 60, 59, 43, 44, 60, 44, 61, 60, 44, 45, 61, 45, 62, 61, 45, 46, 62, 46, 63, 62, 46, 47, 63, 48, 65, 64, 48, 49, 65, 49, 66, 65, 49, 50, 66, 50, 67, 66, 50, 51, 67, 51, 68, 67, 51, 52, 68, 52, 69, 68, 52, 53, 69, 53, 70, 69, 53, 54, 70, 54, 71, 70, 54, 55, 71, 55, 72, 71, 55, 56, 72, 56, 73, 72, 56, 57, 73, 57, 74, 73, 57, 58, 74, 58, 75, 74, 58, 59, 75, 59, 76, 75, 59, 60, 76, 60, 77, 76, 60, 61, 77, 61, 78, 77, 61, 62, 78, 62, 79, 78, 62, 63, 79, 64, 81, 80, 64, 65, 81, 65, 82, 81, 65, 66, 82, 66, 83, 82, 66, 67, 83, 67, 84, 83, 67, 68, 84, 68, 85, 84, 68, 69, 85, 69, 86, 85, 69, 70, 86, 70, 87, 86, 70, 71, 87, 71, 88, 87, 71, 72, 88, 72, 89, 88, 72, 73, 89, 73, 90, 89, 73, 74, 90, 74, 91, 90, 74, 75, 91, 75, 92, 91, 75, 76, 92, 76, 93, 92, 76, 77, 93, 77, 94, 93, 77, 78, 94, 78, 95, 94, 78, 79, 95, 80, 97, 96, 80, 81, 97, 81, 98, 97, 81, 82, 98, 82, 99, 98, 82, 83, 99, 83, 100, 99, 83, 84, 100, 84, 101, 100, 84, 85, 101, 85, 102, 101, 85, 86, 102, 86, 103, 102, 86, 87, 103, 87, 104, 103, 87, 88, 104, 88, 105, 104, 88, 89, 105, 89, 106, 105, 89, 90, 106, 90, 107, 106, 90, 91, 107, 91, 108, 107, 91, 92, 108, 92, 109, 108, 92, 93, 109, 93, 110, 109, 93, 94, 110, 94, 111, 110, 94, 95, 111, 96, 113, 112, 96, 97, 113, 97, 114, 113, 97, 98, 114, 98, 115, 114, 98, 99, 115, 99, 116, 115, 99, 100, 116, 100, 117, 116, 100, 101, 117, 101, 118, 117, 101, 102, 118, 102, 119, 118, 102, 103, 119, 103, 120, 119, 103, 104, 120, 104, 121, 120, 104, 105, 121, 105, 122, 121, 105, 106, 122, 106, 123, 122, 106, 107, 123, 107, 124, 123, 107, 108, 124, 108, 125, 124, 108, 109, 125, 109, 126, 125, 109, 110, 126, 110, 127, 126, 110, 111, 127, 112, 129, 128, 112, 113, 129, 113, 130, 129, 113, 114, 130, 114, 131, 130, 114, 115, 131, 115, 132, 131, 115, 116, 132, 116, 133, 132, 116, 117, 133, 117, 134, 133, 117, 118, 134, 118, 135, 134, 118, 119, 135, 119, 136, 135, 119, 120, 136, 120, 137, 136, 120, 121, 137, 121, 138, 137, 121, 122, 138, 122, 139, 138, 122, 123, 139, 123, 140, 139, 123, 124, 140, 124, 141, 140, 124, 125, 141, 125, 142, 141, 125, 126, 142, 126, 143, 142, 126, 127, 143, 128, 145, 144, 128, 129, 145, 129, 146, 145, 129, 130, 146, 130, 147, 146, 130, 131, 147, 131, 148, 147, 131, 132, 148, 132, 149, 148, 132, 133, 149, 133, 150, 149, 133, 134, 150, 134, 151, 150, 134, 135, 151, 135, 152, 151, 135, 136, 152, 136, 153, 152, 136, 137, 153, 137, 154, 153, 137, 138, 154, 138, 155, 154, 138, 139, 155, 139, 156, 155, 139, 140, 156, 140, 157, 156, 140, 141, 157, 141, 158, 157, 141, 142, 158, 142, 159, 158, 142, 143, 159, 144, 161, 160, 144, 145, 161, 145, 162, 161, 145, 146, 162, 146, 163, 162, 146, 147, 163, 147, 164, 163, 147, 148, 164, 148, 165, 164, 148, 149, 165, 149, 166, 165, 149, 150, 166, 150, 167, 166, 150, 151, 167, 151, 168, 167, 151, 152, 168, 152, 169, 168, 152, 153, 169, 153, 170, 169, 153, 154, 170, 154, 171, 170, 154, 155, 171, 155, 172, 171, 155, 156, 172, 156, 173, 172, 156, 157, 173, 157, 174, 173, 157, 158, 174, 158, 175, 174, 158, 159, 175, 160, 177, 176, 160, 161, 177, 161, 178, 177, 161, 162, 178, 162, 179, 178, 162, 163, 179, 163, 180, 179, 163, 164, 180, 164, 181, 180, 164, 165, 181, 165, 182, 181, 165, 166, 182, 166, 183, 182, 166, 167, 183, 167, 184, 183, 167, 168, 184, 168, 185, 184, 168, 169, 185, 169, 186, 185, 169, 170, 186, 170, 187, 186, 170, 171, 187, 171, 188, 187, 171, 172, 188, 172, 189, 188, 172, 173, 189, 173, 190, 189, 173, 174, 190, 174, 191, 190, 174, 175, 191, 176, 193, 192, 176, 177, 193, 177, 194,};
*/
// best version
/*
const GLfloat vertices[]={
 0.382683, 0.923880, 0.000000, 0.000000, 0.000000, 0.349599, 0.923880, 0.155651, 0.066667, 0.000000, 0.256065, 0.923880, 0.284389, 0.133333, 0.000000, 0.118256, 0.923880, 0.363954, 0.200000, 0.000000, -0.040001, 0.923880, 0.380587, 0.266667, 0.000000, -0.191342, 0.923880, 0.331414, 0.333333, 0.000000, -0.309597, 0.923880, 0.224936, 0.400000, 0.000000, -0.374321, 0.923880, 0.079564, 0.466667, 0.000000, -0.374321, 0.923880, -0.079564, 0.533333, 0.000000, -0.309597, 0.923880, -0.224936, 0.600000, 0.000000, -0.191342, 0.923880, -0.331414, 0.666667, 0.000000, -0.040001, 0.923880, -0.380587, 0.733333, 0.000000, 0.118256, 0.923880, -0.363954, 0.800000, 0.000000, 0.256065, 0.923880, -0.284389, 0.866667, 0.000000, 0.349599, 0.923880, -0.155651, 0.933333, 0.000000, 0.382683, 0.923880, 0.000000, 1.000000, 0.000000, 0.555570, 0.831470, 0.000000, 0.000000, 0.076923, 0.507539, 0.831470, 0.225971, 0.066667, 0.076923, 0.371749, 0.831470, 0.412869, 0.133333, 0.076923, 0.171681, 0.831470, 0.528379, 0.200000, 0.076923, -0.058073, 0.831470, 0.552527, 0.266667, 0.076923, -0.277785, 0.831470, 0.481138, 0.333333, 0.076923, -0.449466, 0.831470, 0.326556, 0.400000, 0.076923, -0.543430, 0.831470, 0.115510, 0.466667, 0.076923, -0.543430, 0.831470, -0.115510, 0.533333, 0.076923, -0.449466, 0.831470, -0.326556, 0.600000, 0.076923, -0.277785, 0.831470, -0.481138, 0.666667, 0.076923, -0.058073, 0.831470, -0.552527, 0.733333, 0.076923, 0.171681, 0.831470, -0.528379, 0.800000, 0.076923, 0.371749, 0.831470, -0.412869, 0.866667, 0.076923, 0.507539, 0.831470, -0.225971, 0.933333, 0.076923, 0.555570, 0.831470, 0.000000, 1.000000, 0.076923, 0.707107, 0.707107, 0.000000, 0.000000, 0.153846, 0.645974, 0.707107, 0.287606, 0.066667, 0.153846, 0.473147, 0.707107, 0.525483, 0.133333, 0.153846, 0.218508, 0.707107, 0.672499, 0.200000, 0.153846, -0.073913, 0.707107, 0.703233, 0.266667, 0.153846, -0.353553, 0.707107, 0.612372, 0.333333, 0.153846, -0.572062, 0.707107, 0.415627, 0.400000, 0.153846, -0.691655, 0.707107, 0.147016, 0.466667, 0.153846, -0.691655, 0.707107, -0.147016, 0.533333, 0.153846, -0.572061, 0.707107, -0.415627, 0.600000, 0.153846, -0.353553, 0.707107, -0.612372, 0.666667, 0.153846, -0.073913, 0.707107, -0.703233, 0.733333, 0.153846, 0.218508, 0.707107, -0.672498, 0.800000, 0.153846, 0.473147, 0.707107, -0.525482, 0.866667, 0.153846, 0.645974, 0.707107, -0.287606, 0.933333, 0.153846, 0.707107, 0.707107, 0.000000, 1.000000, 0.153846, 0.831470, 0.555570, 0.000000, 0.000000, 0.230769, 0.759585, 0.555570, 0.338189, 0.066667, 0.230769, 0.556362, 0.555570, 0.617902, 0.133333, 0.230769, 0.256938, 0.555570, 0.790775, 0.200000, 0.230769, -0.086912, 0.555570, 0.826915, 0.266667, 0.230769, -0.415735, 0.555570, 0.720074, 0.333333, 0.230769, -0.672673, 0.555570, 0.488725, 0.400000, 0.230769, -0.813300, 0.555570, 0.172872, 0.466667, 0.230769, -0.813300, 0.555570, -0.172872, 0.533333, 0.230769, -0.672673, 0.555570, -0.488726, 0.600000, 0.230769, -0.415735, 0.555570, -0.720074, 0.666667, 0.230769, -0.086912, 0.555570, -0.826915, 0.733333, 0.230769, 0.256939, 0.555570, -0.790774, 0.800000, 0.230769, 0.556362, 0.555570, -0.617902, 0.866667, 0.230769, 0.759585, 0.555570, -0.338189, 0.933333, 0.230769, 0.831470, 0.555570, 0.000000, 1.000000, 0.230769, 0.923880, 0.382683, 0.000000, 0.000000, 0.307692, 0.844006, 0.382683, 0.375776, 0.066667, 0.307692, 0.618196, 0.382683, 0.686576, 0.133333, 0.307692, 0.285494, 0.382683, 0.878662, 0.200000, 0.307692, -0.096572, 0.382683, 0.918818, 0.266667, 0.307692, -0.461940, 0.382683, 0.800103, 0.333333, 0.307692, -0.747434, 0.382683, 0.543043, 0.400000, 0.307692, -0.903691, 0.382683, 0.192085, 0.466667, 0.307692, -0.903691, 0.382683, -0.192085, 0.533333, 0.307692, -0.747434, 0.382683, -0.543043, 0.600000, 0.307692, -0.461940, 0.382683, -0.800103, 0.666667, 0.307692, -0.096572, 0.382683, -0.918818, 0.733333, 0.307692, 0.285495, 0.382683, -0.878661, 0.800000, 0.307692, 0.618196, 0.382683, -0.686576, 0.866667, 0.307692, 0.844006, 0.382683, -0.375776, 0.933333, 0.307692, 0.923880, 0.382683, 0.000000, 1.000000, 0.307692, 0.980785, 0.195090, 0.000000, 0.000000, 0.384615, 0.895992, 0.195090, 0.398921, 0.066667, 0.384615, 0.656273, 0.195090, 0.728866, 0.133333, 0.384615, 0.303079, 0.195090, 0.932782, 0.200000, 0.384615, -0.102520, 0.195090, 0.975412, 0.266667, 0.384615, -0.490393, 0.195090, 0.849385, 0.333333, 0.384615, -0.793472, 0.195090, 0.576491, 0.400000, 0.384615, -0.959353, 0.195090, 0.203917, 0.466667, 0.384615, -0.959353, 0.195090, -0.203917, 0.533333, 0.384615, -0.793472, 0.195090, -0.576491, 0.600000, 0.384615, -0.490393, 0.195090, -0.849385, 0.666667, 0.384615, -0.102520, 0.195090, -0.975412, 0.733333, 0.384615, 0.303080, 0.195090, -0.932782, 0.800000, 0.384615, 0.656274, 0.195090, -0.728865, 0.866667, 0.384615, 0.895992, 0.195090, -0.398921, 0.933333, 0.384615, 0.980785, 0.195090, 0.000000, 1.000000, 0.384615, 1.000000, 0.000000, 0.000000, 0.000000, 0.461538, 0.913545, 0.000000, 0.406737, 0.066667, 0.461538, 0.669131, 0.000000, 0.743145, 0.133333, 0.461538, 0.309017, 0.000000, 0.951057, 0.200000, 0.461538, -0.104529, 0.000000, 0.994522, 0.266667, 0.461538, -0.500000, 0.000000, 0.866025, 0.333333, 0.461538, -0.809017, 0.000000, 0.587785, 0.400000, 0.461538, -0.978148, 0.000000, 0.207912, 0.466667, 0.461538, -0.978148, 0.000000, -0.207912, 0.533333, 0.461538, -0.809017, 0.000000, -0.587785, 0.600000, 0.461538, -0.500000, 0.000000, -0.866025, 0.666667, 0.461538, -0.104528, 0.000000, -0.994522, 0.733333, 0.461538, 0.309018, 0.000000, -0.951056, 0.800000, 0.461538, 0.669131, 0.000000, -0.743144, 0.866667, 0.461538, 0.913546, 0.000000, -0.406736, 0.933333, 0.461538, 1.000000, 0.000000, 0.000000, 1.000000, 0.461538, 0.980785, -0.195090, 0.000000, 0.000000, 0.538462, 0.895992, -0.195090, 0.398921, 0.066667, 0.538462, 0.656273, -0.195090, 0.728866, 0.133333, 0.538462, 0.303079, -0.195090, 0.932782, 0.200000, 0.538462, -0.102520, -0.195090, 0.975412, 0.266667, 0.538462, -0.490393, -0.195090, 0.849385, 0.333333, 0.538462, -0.793472, -0.195090, 0.576491, 0.400000, 0.538462, -0.959353, -0.195090, 0.203917, 0.466667, 0.538462, -0.959353, -0.195090, -0.203917, 0.533333, 0.538462, -0.793472, -0.195090, -0.576491, 0.600000, 0.538462, -0.490393, -0.195090, -0.849385, 0.666667, 0.538462, -0.102520, -0.195090, -0.975412, 0.733333, 0.538462, 0.303080, -0.195090, -0.932782, 0.800000, 0.538462, 0.656274, -0.195090, -0.728865, 0.866667, 0.538462, 0.895992, -0.195090, -0.398921, 0.933333, 0.538462, 0.980785, -0.195090, 0.000000, 1.000000, 0.538462, 0.923880, -0.382683, 0.000000, 0.000000, 0.615385, 0.844006, -0.382683, 0.375776, 0.066667, 0.615385, 0.618196, -0.382683, 0.686576, 0.133333, 0.615385, 0.285494, -0.382683, 0.878662, 0.200000, 0.615385, -0.096572, -0.382683, 0.918818, 0.266667, 0.615385, -0.461940, -0.382683, 0.800103, 0.333333, 0.615385, -0.747434, -0.382683, 0.543043, 0.400000, 0.615385, -0.903691, -0.382683, 0.192085, 0.466667, 0.615385, -0.903691, -0.382683, -0.192085, 0.533333, 0.615385, -0.747434, -0.382683, -0.543043, 0.600000, 0.615385, -0.461940, -0.382683, -0.800103, 0.666667, 0.615385, -0.096572, -0.382683, -0.918818, 0.733333, 0.615385, 0.285495, -0.382683, -0.878661, 0.800000, 0.615385, 0.618196, -0.382683, -0.686576, 0.866667, 0.615385, 0.844006, -0.382683, -0.375776, 0.933333, 0.615385, 0.923880, -0.382683, 0.000000, 1.000000, 0.615385, 0.831470, -0.555570, 0.000000, 0.000000, 0.692308, 0.759585, -0.555570, 0.338189, 0.066667, 0.692308, 0.556362, -0.555570, 0.617902, 0.133333, 0.692308, 0.256938, -0.555570, 0.790775, 0.200000, 0.692308, -0.086912, -0.555570, 0.826915, 0.266667, 0.692308, -0.415735, -0.555570, 0.720074, 0.333333, 0.692308, -0.672673, -0.555570, 0.488725, 0.400000, 0.692308, -0.813300, -0.555570, 0.172872, 0.466667, 0.692308, -0.813300, -0.555570, -0.172872, 0.533333, 0.692308, -0.672673, -0.555570, -0.488726, 0.600000, 0.692308, -0.415735, -0.555570, -0.720074, 0.666667, 0.692308, -0.086912, -0.555570, -0.826915, 0.733333, 0.692308, 0.256939, -0.555570, -0.790774, 0.800000, 0.692308, 0.556362, -0.555570, -0.617902, 0.866667, 0.692308, 0.759585, -0.555570, -0.338189, 0.933333, 0.692308, 0.831470, -0.555570, 0.000000, 1.000000, 0.692308, 0.707107, -0.707107, 0.000000, 0.000000, 0.769231, 0.645974, -0.707107, 0.287606, 0.066667, 0.769231, 0.473147, -0.707107, 0.525483, 0.133333, 0.769231, 0.218508, -0.707107, 0.672499, 0.200000, 0.769231, -0.073913, -0.707107, 0.703233, 0.266667, 0.769231, -0.353553, -0.707107, 0.612372, 0.333333, 0.769231, -0.572062, -0.707107, 0.415627, 0.400000, 0.769231, -0.691655, -0.707107, 0.147016, 0.466667, 0.769231, -0.691655, -0.707107, -0.147016, 0.533333, 0.769231, -0.572061, -0.707107, -0.415627, 0.600000, 0.769231, -0.353553, -0.707107, -0.612372, 0.666667, 0.769231, -0.073913, -0.707107, -0.703233, 0.733333, 0.769231, 0.218508, -0.707107, -0.672498, 0.800000, 0.769231, 0.473147, -0.707107, -0.525482, 0.866667, 0.769231, 0.645974, -0.707107, -0.287606, 0.933333, 0.769231, 0.707107, -0.707107, 0.000000, 1.000000, 0.769231, 0.555570, -0.831470, 0.000000, 0.000000, 0.846154, 0.507539, -0.831470, 0.225971, 0.066667, 0.846154, 0.371749, -0.831470, 0.412869, 0.133333, 0.846154, 0.171681, -0.831470, 0.528379, 0.200000, 0.846154, -0.058073, -0.831470, 0.552527, 0.266667, 0.846154, -0.277785, -0.831470, 0.481138, 0.333333, 0.846154, -0.449466, -0.831470, 0.326556, 0.400000, 0.846154, -0.543430, -0.831470, 0.115510, 0.466667, 0.846154, -0.543430, -0.831470, -0.115510, 0.533333, 0.846154, -0.449466, -0.831470, -0.326556, 0.600000, 0.846154, -0.277785, -0.831470, -0.481138, 0.666667, 0.846154, -0.058073, -0.831470, -0.552527, 0.733333, 0.846154, 0.171681, -0.831470, -0.528379, 0.800000, 0.846154, 0.371749, -0.831470, -0.412869, 0.866667, 0.846154, 0.507539, -0.831470, -0.225971, 0.933333, 0.846154, 0.555570, -0.831470, 0.000000, 1.000000, 0.846154, 0.382683, -0.923880, 0.000000, 0.000000, 0.923077,};
const GLuint indices[]={
 0, 17, 16, 0, 1, 17, 1, 18, 17, 1, 2, 18, 2, 19, 18, 2, 3, 19, 3, 20, 19, 3, 4, 20, 4, 21, 20, 4, 5, 21, 5, 22, 21, 5, 6, 22, 6, 23, 22, 6, 7, 23, 7, 24, 23, 7, 8, 24, 8, 25, 24, 8, 9, 25, 9, 26, 25, 9, 10, 26, 10, 27, 26, 10, 11, 27, 11, 28, 27, 11, 12, 28, 12, 29, 28, 12, 13, 29, 13, 30, 29, 13, 14, 30, 14, 31, 30, 14, 15, 31, 16, 33, 32, 16, 17, 33, 17, 34, 33, 17, 18, 34, 18, 35, 34, 18, 19, 35, 19, 36, 35, 19, 20, 36, 20, 37, 36, 20, 21, 37, 21, 38, 37, 21, 22, 38, 22, 39, 38, 22, 23, 39, 23, 40, 39, 23, 24, 40, 24, 41, 40, 24, 25, 41, 25, 42, 41, 25, 26, 42, 26, 43, 42, 26, 27, 43, 27, 44, 43, 27, 28, 44, 28, 45, 44, 28, 29, 45, 29, 46, 45, 29, 30, 46, 30, 47, 46, 30, 31, 47, 32, 49, 48, 32, 33, 49, 33, 50, 49, 33, 34, 50, 34, 51, 50, 34, 35, 51, 35, 52, 51, 35, 36, 52, 36, 53, 52, 36, 37, 53, 37, 54, 53, 37, 38, 54, 38, 55, 54, 38, 39, 55, 39, 56, 55, 39, 40, 56, 40, 57, 56, 40, 41, 57, 41, 58, 57, 41, 42, 58, 42, 59, 58, 42, 43, 59, 43, 60, 59, 43, 44, 60, 44, 61, 60, 44, 45, 61, 45, 62, 61, 45, 46, 62, 46, 63, 62, 46, 47, 63, 48, 65, 64, 48, 49, 65, 49, 66, 65, 49, 50, 66, 50, 67, 66, 50, 51, 67, 51, 68, 67, 51, 52, 68, 52, 69, 68, 52, 53, 69, 53, 70, 69, 53, 54, 70, 54, 71, 70, 54, 55, 71, 55, 72, 71, 55, 56, 72, 56, 73, 72, 56, 57, 73, 57, 74, 73, 57, 58, 74, 58, 75, 74, 58, 59, 75, 59, 76, 75, 59, 60, 76, 60, 77, 76, 60, 61, 77, 61, 78, 77, 61, 62, 78, 62, 79, 78, 62, 63, 79, 64, 81, 80, 64, 65, 81, 65, 82, 81, 65, 66, 82, 66, 83, 82, 66, 67, 83, 67, 84, 83, 67, 68, 84, 68, 85, 84, 68, 69, 85, 69, 86, 85, 69, 70, 86, 70, 87, 86, 70, 71, 87, 71, 88, 87, 71, 72, 88, 72, 89, 88, 72, 73, 89, 73, 90, 89, 73, 74, 90, 74, 91, 90, 74, 75, 91, 75, 92, 91, 75, 76, 92, 76, 93, 92, 76, 77, 93, 77, 94, 93, 77, 78, 94, 78, 95, 94, 78, 79, 95, 80, 97, 96, 80, 81, 97, 81, 98, 97, 81, 82, 98, 82, 99, 98, 82, 83, 99, 83, 100, 99, 83, 84, 100, 84, 101, 100, 84, 85, 101, 85, 102, 101, 85, 86, 102, 86, 103, 102, 86, 87, 103, 87, 104, 103, 87, 88, 104, 88, 105, 104, 88, 89, 105, 89, 106, 105, 89, 90, 106, 90, 107, 106, 90, 91, 107, 91, 108, 107, 91, 92, 108, 92, 109, 108, 92, 93, 109, 93, 110, 109, 93, 94, 110, 94, 111, 110, 94, 95, 111, 96, 113, 112, 96, 97, 113, 97, 114, 113, 97, 98, 114, 98, 115, 114, 98, 99, 115, 99, 116, 115, 99, 100, 116, 100, 117, 116, 100, 101, 117, 101, 118, 117, 101, 102, 118, 102, 119, 118, 102, 103, 119, 103, 120, 119, 103, 104, 120, 104, 121, 120, 104, 105, 121, 105, 122, 121, 105, 106, 122, 106, 123, 122, 106, 107, 123, 107, 124, 123, 107, 108, 124, 108, 125, 124, 108, 109, 125, 109, 126, 125, 109, 110, 126, 110, 127, 126, 110, 111, 127, 112, 129, 128, 112, 113, 129, 113, 130, 129, 113, 114, 130, 114, 131, 130, 114, 115, 131, 115, 132, 131, 115, 116, 132, 116, 133, 132, 116, 117, 133, 117, 134, 133, 117, 118, 134, 118, 135, 134, 118, 119, 135, 119, 136, 135, 119, 120, 136, 120, 137, 136, 120, 121, 137, 121, 138, 137, 121, 122, 138, 122, 139, 138, 122, 123, 139, 123, 140, 139, 123, 124, 140, 124, 141, 140, 124, 125, 141, 125, 142, 141, 125, 126, 142, 126, 143, 142, 126, 127, 143, 128, 145, 144, 128, 129, 145, 129, 146, 145, 129, 130, 146, 130, 147, 146, 130, 131, 147, 131, 148, 147, 131, 132, 148, 132, 149, 148, 132, 133, 149, 133, 150, 149, 133, 134, 150, 134, 151, 150, 134, 135, 151, 135, 152, 151, 135, 136, 152, 136, 153, 152, 136, 137, 153, 137, 154, 153, 137, 138, 154, 138, 155, 154, 138, 139, 155, 139, 156, 155, 139, 140, 156, 140, 157, 156, 140, 141, 157, 141, 158, 157, 141, 142, 158, 142, 159, 158, 142, 143, 159, 144, 161, 160, 144, 145, 161, 145, 162, 161, 145, 146, 162, 146, 163, 162, 146, 147, 163, 147, 164, 163, 147, 148, 164, 148, 165, 164, 148, 149, 165, 149, 166, 165, 149, 150, 166, 150, 167, 166, 150, 151, 167, 151, 168, 167, 151, 152, 168, 152, 169, 168, 152, 153, 169, 153, 170, 169, 153, 154, 170, 154, 171, 170, 154, 155, 171, 155, 172, 171, 155, 156, 172, 156, 173, 172, 156, 157, 173, 157, 174, 173, 157, 158, 174, 158, 175, 174, 158, 159, 175, 160, 177, 176, 160, 161, 177, 161, 178, 177, 161, 162, 178, 162, 179, 178, 162, 163, 179, 163, 180, 179, 163, 164, 180, 164, 181, 180, 164, 165, 181, 165, 182, 181, 165, 166, 182, 166, 183, 182, 166, 167, 183, 167, 184, 183, 167, 168, 184, 168, 185, 184, 168, 169, 185, 169, 186, 185, 169, 170, 186, 170, 187, 186, 170, 171, 187, 171, 188, 187, 171, 172, 188, 172, 189, 188, 172, 173, 189, 173, 190, 189, 173, 174, 190, 174, 191, 190, 174, 175, 191, 176, 193, 192, 176, 177, 193, 177, 194,};
*/
/*******************************************************************/
// screen resolution
const GLuint SCR_WIDTH = 1920;
const GLuint SCR_HEIGHT = 1080; 

// camera position
typedef struct Camera{
    vec3 cameraPos;
    GLfloat fov;
    versor resultQuat;
}Camera;

pthread_mutex_t mutexLock;
// time
// struct timespec start, end;

const GLchar *vertexShaderSource = 
    "#version 460 core\n"
    "layout (location = 0) in vec3 aPos;\n"
    "layout (location = 1) in vec2 aTexCoord;\n"
    "out vec2 TexCoord;\n"
    "uniform mat4 model;\n"
    "uniform mat4 view;\n"
    "uniform mat4 proj;\n"
    "void main()\n"
    "{\n"
    "   gl_Position = proj*view*model*vec4(aPos.x, aPos.y, aPos.z , 1.);\n" // local space to clip space
    "   TexCoord = vec2(1. - aTexCoord.x, aTexCoord.y);\n" // mirror textures for inside sphere
    "}\n\0";

const GLchar *fragmentShaderSource = 
    "#version 460 core\n"
    "in vec2 TexCoord;\n"
    "out vec4 FragColor;\n"
    "uniform sampler2D texture1;\n" 
    "void main()\n"
    "{\n"
    "   FragColor = texture(texture1, TexCoord);\n" 
    "}\n\0";

static int ORQA_initGLFW(ORQA_NOARGS void);
static  GLfloat ORQA_radians(ORQA_IN const GLfloat deg);
static  void ORQA_mouse_callback(ORQA_REF GLFWwindow *window, ORQA_IN const GLdouble xpos, ORQA_IN const GLdouble ypos);
static void ORQA_processInput(ORQA_REF GLFWwindow *window);
static void ORQA_framebuffer_size_callback(ORQA_REF GLFWwindow *window,ORQA_IN GLint width,ORQA_IN GLint height);
static void ORQA_scroll_callback(ORQA_REF GLFWwindow *window,ORQA_IN GLdouble xoffset,ORQA_IN GLdouble yoffset);
static void* ORQA_tcp_thread(ORQA_REF Camera *c);

int main(){
    if (ORQA_initGLFW() == -1) return 0;
    glfwWindowHint(GLFW_DECORATED, GLFW_FALSE); // no borders -> Full screen
    GLFWwindow *window = glfwCreateWindow(SCR_WIDTH, SCR_HEIGHT, "The Project", NULL, NULL); // glfw window object creation
    if (window == NULL){
        fprintf(stderr, "In file: %s, line: %d Failed to create GLFW window\n", __FILE__, __LINE__);
        glfwTerminate();
        return -1;
    }
    glfwMakeContextCurrent(window);

    glfwSetFramebufferSizeCallback(window, ORQA_framebuffer_size_callback); // manipulate view port
    glfwSetCursorPosCallback(window, ORQA_mouse_callback); // move camera with cursor
    glfwSetInputMode(window, GLFW_CURSOR, GLFW_CURSOR_DISABLED); // use cursor but do not display it
    glfwSetScrollCallback(window, ORQA_scroll_callback); // zoom in/out using mouse wheel

    if (!gladLoadGLLoader((GLADloadproc)glfwGetProcAddress)){ // glad: load all OpenGL function pointers. GLFW gives us glfwGetProcAddress that defines the correct function based on which OS we're compiling for
        fprintf(stderr, "In file: %s, line: %d Failed to create initialize GLAD\n", __FILE__, __LINE__);
        glfwTerminate();
        return -1;
    }    

    // generating sphere
    sphere sph;
    sph.radius = 1.0f; sph.sectors = 100; sph.stacks = 100;
    ORQA_GenSphere(&sph);
    GLfloat vertices[sph.numVertices*5]; for(int i = 0; i < sph.numVertices*5; i++) vertices[i] = *(sph.Vs + i);
    GLuint indices[sph.numTriangles*3]; for(int i = 0; i < sph.numTriangles*3; i++) indices[i] = *(sph.Is + i);
    ORQA_Sphere_free(&sph);

    // shader stuff
    GLuint vertexShader = glCreateShader(GL_VERTEX_SHADER); 
    GLuint fragmentShader = glCreateShader(GL_FRAGMENT_SHADER);
    GLuint shaderProgram = glCreateProgram();
    GLint success;
    GLchar infoLog[BUFSIZE];

    glShaderSource(vertexShader, 1, &vertexShaderSource, NULL);
    glCompileShader(vertexShader);
    glShaderSource(fragmentShader, 1, &fragmentShaderSource, NULL);
    glCompileShader(fragmentShader);
    glGetShaderiv(vertexShader, GL_COMPILE_STATUS, &success);
    if (!success){
        glGetShaderInfoLog(vertexShader, BUFSIZE, NULL, infoLog);
        fprintf(stderr, "In file: %s, line: %d ERROR::SHADER::VERTEX::COMPILATION_FAILED\nError:\n%s\n", __FILE__, __LINE__, infoLog);
        goto shaderError; 
    }
    glGetShaderiv(fragmentShader, GL_COMPILE_STATUS, &success);
    if (!success){
        glGetShaderInfoLog(fragmentShader, BUFSIZE, NULL, infoLog);
        fprintf(stderr, "In file: %s, line: %d ERROR::SHADER::FRAGMENT::COMPILATION_FAILED\nError:\n%s\n", __FILE__, __LINE__, infoLog);
        goto shaderError;
    }
    glAttachShader(shaderProgram, vertexShader);
    glAttachShader(shaderProgram, fragmentShader);
    glLinkProgram(shaderProgram);
    glGetProgramiv(shaderProgram, GL_LINK_STATUS, &success);
    if (!success) {
        glGetProgramInfoLog(shaderProgram, BUFSIZE, NULL, infoLog);
        fprintf(stderr, "In file: %s, line: %d ERROR::SHADER::PROGRAM::LINKING_FAILED\nError:\n%s\n", __FILE__, __LINE__, infoLog);
        goto linkingError; 
    } 

    GLuint VBO, VAO, EBO;
    glGenVertexArrays(1, &VAO);
    glGenBuffers(1, &VBO); 
    glGenBuffers(1, &EBO);
    glBindVertexArray(VAO); 
    glBindBuffer(GL_ARRAY_BUFFER , VBO);
    glBufferData(GL_ARRAY_BUFFER , sizeof(vertices), vertices, GL_STATIC_DRAW );
    glBindBuffer(GL_ELEMENT_ARRAY_BUFFER , EBO);
    glBufferData(GL_ELEMENT_ARRAY_BUFFER , sizeof(indices), indices, GL_STATIC_DRAW );

    GLuint positionLocation = glGetAttribLocation(shaderProgram, "aPos");
    GLuint texCoordLocation = glGetAttribLocation(shaderProgram, "aTexCoord");
    glVertexAttribPointer(positionLocation, 3, GL_FLOAT, GL_FALSE, 5 * sizeof(float), (float*)0);
    glEnableVertexAttribArray(positionLocation);
    glVertexAttribPointer(texCoordLocation, 2, GL_FLOAT, GL_FALSE,  5 * sizeof(float), (void*)(3* sizeof(float)));
    glEnableVertexAttribArray(texCoordLocation);

    GLuint texture;
    glGenTextures(1, &texture);
    glBindTexture(GL_TEXTURE_2D, texture);

    Camera cam;
    cam.cameraPos[0] = 0.0f; cam.cameraPos[1] = 0.0f; cam.cameraPos[2] = 0.0f;
    cam.resultQuat[0] = 0.0f; cam.resultQuat[1] = 0.0f; cam.resultQuat[2] = 0.0f; cam.resultQuat[3] = 1.0f;
    cam.fov = 4.8f;
    glfwSetWindowUserPointer(window, &cam);

    // loading video file!
    // Before loading generate RGB: $ ffmpeg -y -i input.mp4 -c:v libx264rgb output.mp4
    video_reader vr_state;
    if(!ORQA_video_reader_open_file(&vr_state, "../data/360videoRGB.mp4")){
        printf("Could not open file\n");
        return 1;
    }
    const GLuint width = vr_state.width;  const GLuint height = vr_state.height;

    /*
    // loading image!
    GLuint im_width, im_height, im_nrChannels;
    // unsigned char *data = stbi_load("../data/result0.jpg", &im_width, &im_height, &im_nrChannels, 0); 
    // unsigned char *data = stbi_load("../data/panorama1.bmp", &im_width, &im_height, &im_nrChannels, 0); 
    // unsigned char *data = stbi_load("../data/result2.jpg", &im_width, &im_height, &im_nrChannels, 0); 
    // unsigned char *data = stbi_load("../data/earth.jpg", &im_width, &im_height, &im_nrChannels, 0); 
    unsigned char *data = stbi_load("../data/360test.jpg", &im_width, &im_height, &im_nrChannels, 0); 
    if (data){
        glTexImage2D(GL_TEXTURE_2D, 0, GL_RGB, im_width, im_height, 0, GL_RGB, GL_UNSIGNED_BYTE, data);
        glGenerateMipmap(GL_TEXTURE_2D);
    } else fprintf(stderr, "In file: %s, line: %d Failed to load texture\n", __FILE__, __LINE__);
    stbi_image_free(data);*/

    // MVP matrices
    mat4 model, projection, view;
    GLuint modelLoc = glGetUniformLocation(shaderProgram, "model");
    GLuint viewLoc = glGetUniformLocation(shaderProgram, "view");
    GLuint projLoc = glGetUniformLocation(shaderProgram, "proj");

    glm_mat4_identity(model); glm_mat4_identity(view); glm_mat4_identity(projection);

    // TCP thread init
    // pthread_t tcp_thread;
    // pthread_create(&tcp_thread, NULL, ORQA_tcp_thread, &cam);
    if (pthread_mutex_init(&mutexLock, NULL) != 0) {
        fprintf(stderr, "Mutex init has failed! \n");
        return 1;
    }

    glBindBuffer(GL_ARRAY_BUFFER, 0); 

    while (!glfwWindowShouldClose(window)){ // render loop
        // input
        ORQA_processInput(window);

        // render
        glClearColor(0.2f, 0.2f, 0.2f, 1.0f);
        glClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT);
        glUseProgram(shaderProgram);

        glm_perspective(cam.fov, (GLfloat)SCR_WIDTH / (GLfloat)SCR_HEIGHT, 0.01f, 100.0f, projection); // zoom

        glm_quat_look(cam.cameraPos, cam.resultQuat, view);

        // send MVP matrices to vertex shader
        glUniformMatrix4fv(modelLoc, 1, GL_FALSE, &model[0][0]); 
        glUniformMatrix4fv(viewLoc, 1, GL_FALSE, &view[0][0]); 
        glUniformMatrix4fv(projLoc, 1, GL_FALSE, &projection[0][0]); 
        
        // get video frame
        uint8_t *frame_data = ORQA_video_reader_read_frame(&vr_state);
        glTexImage2D(GL_TEXTURE_2D, 0, GL_RGB, width, height, 0, GL_RGB, GL_UNSIGNED_BYTE, frame_data); 
        glGenerateMipmap(GL_TEXTURE_2D);
        free (frame_data);

        // build texture
        glBindTexture(GL_TEXTURE_2D, texture);

        // draw
        glDrawElements(GL_TRIANGLES, sizeof(vertices), GL_UNSIGNED_INT, 0);

        // glfw: swap buffers and poll IO events
        glfwSwapBuffers(window);
        glfwPollEvents();
    }
    // deallocating stuff
    ORQA_video_reader_free(&vr_state);
    pthread_exit(NULL);
    glDeleteVertexArrays(1, &VAO); 
    glDeleteBuffers(1, &VBO);
    glDeleteBuffers(1, &EBO);
    glDeleteTextures(1, &texture);
    linkingError:
    glDeleteProgram(shaderProgram);
    shaderError:
    glDeleteShader(vertexShader);
    glDeleteShader(fragmentShader);
    // glfw: terminate, clearing all previously allocated GLFW resources.
    glfwTerminate(); 
    return 0;
}
/*
// time in nanoseconds?
clock_gettime(CLOCK_REALTIME, &start);
clock_gettime(CLOCK_REALTIME, &end);
double time = (end.tv_nsec - start.tv_nsec);
printf("%f\n", time);
*/

static GLfloat ORQA_radians(ORQA_IN const GLfloat deg){ // calculate radians
    return (deg*M_PI/180.0f); 
}

static int ORQA_initGLFW(ORQA_NOARGS void){ // glfw: we first initialize GLFW with glfwInit, after which we can configure GLFW using glfwWindowHint
    if(!glfwInit()){
        fprintf(stderr, "In file: %s, line: %d Failed to initialize GLFW\n", __FILE__, __LINE__);
        glfwTerminate();
        return -1;
    }
    glfwWindowHint(GLFW_CONTEXT_VERSION_MAJOR, 3); // Specify API version 3.3
    glfwWindowHint(GLFW_CONTEXT_VERSION_MINOR, 3); // Specify API version 3.3
    glfwWindowHint(GLFW_OPENGL_PROFILE, GLFW_OPENGL_CORE_PROFILE); // creating contex profile
    
    return 0;
}

static void ORQA_processInput(ORQA_REF GLFWwindow *window){ // keeps all the input code
    if(glfwGetKey(window, GLFW_KEY_ESCAPE) == GLFW_PRESS){ // closes window on ESC
        glfwSetWindowShouldClose(window, GL_TRUE);
    }
}

static void ORQA_framebuffer_size_callback(ORQA_REF GLFWwindow *window,ORQA_IN GLint width,ORQA_IN GLint height){
    glViewport(0, 0, width, height); // size of the rendering window
}

static void ORQA_scroll_callback(ORQA_REF GLFWwindow *window, ORQA_IN GLdouble xoffset, ORQA_IN GLdouble yoffset){
    Camera *cam = glfwGetWindowUserPointer(window);	
    cam->fov -= (GLfloat)yoffset/5;
    if (cam->fov < 4.8f) cam->fov = 4.8f;
    if (cam->fov > 6.2f) cam->fov = 6.2f;   
}

static void ORQA_mouse_callback(ORQA_REF GLFWwindow *window, ORQA_IN const GLdouble xpos, ORQA_IN const GLdouble ypos){
    Camera *cam = glfwGetWindowUserPointer(window);	
    versor pitchQuat, yawQuat;
    float yaw, pitch;

    yaw = ORQA_radians(xpos/10); pitch = ORQA_radians(ypos/10); 

    glm_quatv(pitchQuat, pitch, (vec3){1.0f, 0.0f, 0.0f});
    glm_quatv(yawQuat, yaw, (vec3){0.0f, 1.0f, 0.0f}); 

    glm_quat_mul(yawQuat, pitchQuat, cam->resultQuat);
}

static void *ORQA_tcp_thread(ORQA_REF Camera *c){

    int parentfd, childfd, n;
    unsigned int clientlen; 
    struct sockaddr_in serveraddr, clientaddr; 
    char jsonStr[BUFSIZE];
    float yaw, pitch, roll;
    int optval = 1;
    int portno = 8000;
    mat4 rollMat; glm_mat4_identity(rollMat);
    versor rollQuat, pitchQuat, yawQuat;
    glm_quat_identity(rollQuat); glm_quat_identity(yawQuat); glm_quat_identity(pitchQuat);

    // create socket
    parentfd = socket(AF_INET, SOCK_STREAM, 0);
    if (parentfd < 0) { perror("ERROR opening socket"); exit(1);}
    
    // socket attributes
    setsockopt(parentfd, SOL_SOCKET, SO_REUSEADDR, (const void *)&optval , sizeof(int));
    bzero((char *) &serveraddr, sizeof(serveraddr));

    serveraddr.sin_family = AF_INET;
    serveraddr.sin_addr.s_addr = htonl(INADDR_ANY);
    serveraddr.sin_port = htons((unsigned short)portno);

    // binding
    if (bind(parentfd, (struct sockaddr *) &serveraddr, sizeof(serveraddr)) < 0) { perror("ERROR on binding"); exit(1); }

    // listening
    if (listen(parentfd, 5) < 0) { perror("ERROR on listen"); exit(1);}
    clientlen = sizeof(clientaddr);

    while (1) {
        childfd = accept(parentfd, (struct sockaddr *) &clientaddr, &clientlen);
        if (childfd < 0) { perror("ERROR on accept"); exit(1);}

        // reading
        bzero(jsonStr, BUFSIZE);
        n = read(childfd, jsonStr, BUFSIZE);
        if (n < 0) { perror("ERROR reading from socket"); exit(1); }
        // printf("server received %d bytes: %s", n, jsonStr);

        // Using quaternions
        JSONObject *json = parseJSON(jsonStr);
        yaw = atof(json->pairs[0].value->stringValue);
        pitch = -atof(json->pairs[1].value->stringValue);
        roll = -atof(json->pairs[2].value->stringValue);
        pthread_mutex_lock(&mutexLock);

        yaw = ORQA_radians(yaw); pitch = ORQA_radians(pitch); roll = ORQA_radians(roll);

        glm_quatv(pitchQuat, pitch, (vec3){1.0f, 0.0f, 0.0f});
        glm_quatv(yawQuat, yaw, (vec3){0.0f, 1.0f, 0.0f}); 
        glm_quatv(rollQuat,roll, (vec3){0.0f, 0.0f, 1.0f});
    
        glm_quat_mul(yawQuat, pitchQuat, c->resultQuat);
        glm_quat_mul(c->resultQuat, rollQuat, c->resultQuat);
        pthread_mutex_unlock(&mutexLock);
    
        close(childfd);
    }
    return 0;
}
